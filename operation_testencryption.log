
Thanks for your patience 
This is an Encrypted virtual machine. Please follow below procedure to troubleshoot the issued virutal machine 
[33m1.Firstly, backup your vhd. You could ether moidfy the OS disk directly or modify the backup vhd
[36maz snapshot create -g ENCRYPTION --source testencryption_OsDisk_1_b101a7feca554f2987be8d50335b22ca --name testencryption_OsDisk_1_b101a7feca554f2987be8d50335b22ca-snapshot
//Create new disk
az disk create --resource-group ENCRYPTION --source testencryption_OsDisk_1_b101a7feca554f2987be8d50335b22ca-snapshot --name testencryption_OsDisk_1_b101a7feca554f2987be8d50335b22ca-copy --sku None
[33m2.(Optional)Allocate the public IP as static if you want to keep the IP address 
[36maz network public-ip update --resource-group ENCRYPTION --name testencryption-ip --allocation-method Static
[33m3.You could delete current virtual machine with below command 
[36maz vm delete -n testencryption -g ENCRYPTION
[33m4.Create temporary troubleshooting virtual machine (for Premium disk, please use vm size Standard_DS1_v2)
[36maz vm create -g ENCRYPTION --image RedHat:RHEL:7.2:latest --admin-username azureuser --admin-password Azuretroubleshooting123! --name temp20180808 --size Standard_A1
[33m5.Enable encryption settigns on troubleshooting vm and disable encryption settings on the issued os Disk(managed disk)
[36maz vm update -n temp20180808 -g ENCRYPTION --set storageProfile.osDisk.encryptionSettings.diskEncryptionKey="{'secretUrl': 'https://keyvault20180409.vault.azure.net/secrets/65f7d565-0854-4ae2-84a2-199f9a1b29ea/48b1bc22ab0141218e90b61506d0c377', 'sourceVault': {'id': '/subscriptions/0f96dbcb-37cf-4c89-94ac-f9672a0ec207/resourceGroups/encryption/providers/Microsoft.KeyVault/vaults/keyvault20180409'}}" storageProfile.osDisk.encryptionSettings.keyEncryptionKey="{'keyUrl': 'https://keyvault20180409.vault.azure.net/keys/Key20180409/f82c1c78c79045c49acbc99ec3914cdf', 'sourceVault': {'id': '/subscriptions/0f96dbcb-37cf-4c89-94ac-f9672a0ec207/resourceGroups/encryption/providers/Microsoft.KeyVault/vaults/keyvault20180409'}}" storageProfile.osDisk.encryptionSettings.Enabled=true 
//Remove encryption settings on issued os disk
az disk update -n testencryption_OsDisk_1_b101a7feca554f2987be8d50335b22ca -g ENCRYPTION --set encryptionSettings.enabled=false encryptionSettings.diskEncryptionKey=null encryptionSettings.keyEncryptionKey=null
[33m6.Attach the issued OS disk to the troubleshooting vm
[36maz vm disk attach --disk testencryption_OsDisk_1_b101a7feca554f2987be8d50335b22ca --resource-group ENCRYPTION --vm-name temp20180808
//Linux commnad reference, suppose /dev/sdc1 is the bek key and /dev/sdd is the issued os disk 
mkdir /{investigatekey,investigateboot,investigateroot}
mount /dev/sdc1 /investigatekey 
mount -o nouuid /dev/sdd1 /investigateboot 
cryptsetup luksOpen --key-file /investigatekey/LinuxPassPhraseFileName --header /investigateboot/luks/osluksheader /dev/sdd2 investigateosencrypt
mount -o nouuid /dev/mapper/investigateosencrypt /investigateroot
[33m7.After troubleshooting, detach the issued os disk from troubleshooting vm 
[36maz vm disk detach -g ENCRYPTION --vm-name temp20180808 -n testencryption_OsDisk_1_b101a7feca554f2987be8d50335b22ca
[33m8.Recreate the virtual machine based on original os disk and attach all data disk 
[36maz vm create --name testencryption --resource-group ENCRYPTION --location southeastasia --nics testencryption777  --size Standard_DS1_v2 --os-type Linux --attach-os-disk testencryption_OsDisk_1_b101a7feca554f2987be8d50335b22ca
az vm disk attach --disk testencryption --resource-group ENCRYPTION --vm-name testencryption --caching ReadOnly
 
[33m9.Update the encrytion settings on the new created virtual machine 
[36maz vm update -n testencryption -g ENCRYPTION --set storageProfile.osDisk.encryptionSettings.diskEncryptionKey="{'secretUrl': 'https://keyvault20180409.vault.azure.net/secrets/65f7d565-0854-4ae2-84a2-199f9a1b29ea/48b1bc22ab0141218e90b61506d0c377', 'sourceVault': {'id': '/subscriptions/0f96dbcb-37cf-4c89-94ac-f9672a0ec207/resourceGroups/encryption/providers/Microsoft.KeyVault/vaults/keyvault20180409'}}" storageProfile.osDisk.encryptionSettings.keyEncryptionKey="{'keyUrl': 'https://keyvault20180409.vault.azure.net/keys/Key20180409/f82c1c78c79045c49acbc99ec3914cdf', 'sourceVault': {'id': '/subscriptions/0f96dbcb-37cf-4c89-94ac-f9672a0ec207/resourceGroups/encryption/providers/Microsoft.KeyVault/vaults/keyvault20180409'}}" storageProfile.osDisk.encryptionSettings.Enabled=true  
[33m10.Enable the encrytpion extension again 
[36maz ad sp reset-credentials --name 5252dcc0-8ad0-4ef5-b2fe-5cb97582fe01 --password <Service Principal Password>
az vm encryption enable --resource-group ENCRYPTION --name testencryption --aad-client-id 5252dcc0-8ad0-4ef5-b2fe-5cb97582fe01 --aad-client-secret <Service Principal password> --disk-encryption-keyvault keyvault20180409 --key-encryption-key Key20180409 --volume-type ALL 
[33m11.(Optional)Enable the Boot Diagnostics
[36maz vm boot-diagnostics enable --name testencryption --resource-group ENCRYPTION --storage https://developenv.blob.core.windows.net
[0m
